language: rust
rust: nightly

branches:
  only:
    - master

env:
  global:
    - RUST_BACKTRACE=1

before_install:
  # Check how much space we've got on this machine.
  - df -h
  - rustup target add wasm32-unknown-unknown --toolchain nightly

jobs:
  include:
    - stage: Check & Prepare
      script: .maintain/ci/format.sh

    - stage: Build
      env: RUST_TOOLCHAIN=nightly
      script: .maintain/ci/build.sh

    - stage: Darwinia Test
      env: Balances RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh balances

    - stage: Darwinia Test
      env: STAKING RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh staking

    - stage: Darwinia Test
      env: ELECTIONSPHRAGMEN RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh elections-phragmen

    - stage: Darwinia Test
      env: TREASURY RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh treasury

    - stage: Darwinia Test
      env: ETHEREUMBACKING RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh ethereum-backing

    - stage: Darwinia Test
      env: ETHEREUMRELAY RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh ethereum-linear-relay

    - stage: Darwinia Test
      env: ETHEREUMOFFCHAIN RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh ethereum-offchain

    - stage: Darwinia Test
      env: ETHEREUMRELAY RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh ethereum-relay

    - stage: Darwinia Test
      env: CLAIMS RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh claims

    - stage: Darwinia Test
      env: HEADERMMR RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh header-mmr

    - stage: Darwinia Test
      env: RELAYERGAME RUST_TOOLCHAIN=nightly
      script: .maintain/ci/tests.sh relayer-game

after_script:
  # Check how much free disk space left after the build
  - df -h
