// This file is part of Darwinia.
//
// Copyright (C) 2018-2022 Darwinia Network
// SPDX-License-Identifier: GPL-3.0
//
// Darwinia is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Darwinia is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Darwinia. If not, see <https://www.gnu.org/licenses/>.

#![cfg(feature = "runtime-benchmarks")]

use super::*;
use crate::Pallet as BscBridge;

use array_bytes::hex2bytes_unchecked;
use bsc_primitives::BSCHeader;
use codec::Decode;
use frame_benchmarking::benchmarks;
use frame_support::{assert_ok, traits::Get};
use frame_system::RawOrigin;
use sp_std::vec::Vec;

// bsc testnet number 0x913570
const GENSIS_HEADER_BYTES: &'static str = "0x58ff628185cd8d77c8592c7349180731fc8f85a8f46be7d7aba572eafbc2ffb71dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d493471284214b9b9c85549ab3d2b972df0deef66ac2c965918191d85321efd8e2b0d9970c316342c62ebfd590198b8e4900f746a20a96e2b722a634ec82422a09a24ba0bc2c3ae4d83df764b872fd24c464634df399cf707b7daac57a5e13c01b3cbcc00f444860cb44b003b468788716464135faba150000200080200000000041000020000002000000080000000800010000400000000800010002000000800201000000841000044000002200000000001020000a000800001000000000000008000000212010000000100000000000022002000200a080201022102208000000200000004000080080000000000000100010000000802000000001000008000040008410000005400100000200000004000000000300200000000080001000000800000000000000000020800202400005001400140000020000002008002000080001000000000000004400208000800800000404100004008450004100000800000040402000000000800808000b000040000002000000000000000000000000000000000000000000000000000000000000007035910000000000bef9c701000000000000000000000000000000000000000000000000000000008c471a00000000000000000000000000000000000000000000000000000000003db9bd6000000000a504d883010100846765746888676f312e31352e35856c696e75780000001600553d1284214b9b9c85549ab3d2b972df0deef66ac2c935552c16704d214347f29fa77f77da6d75d7c7523679479c2402e921db00923e014cd439c606c5967a1a4ad9cc746a70ee58568466f7996dd0ace4e896c5d20b2a975c050e4220be276ace4892f4b41a980a75ecd1309ea12fa2ed87a8744fbfc9b863d5a2959d3f95eae5dc7d70144ce1b73b403b7eb6e0b71b214cb885500844365e95cd9942c7276e7fd8c89c669357d161d57b0b255c94ea96e179999919e625dd7ad2f7b88723857946a41af646c589c3362af12db7da187b9d47f600a1e0c15639d477674640fa9d5fbf9dfaf1d84525f128a3c90b7480be53ad77703837dfead0b31186c4103b85ea08e2c37006e7c413010000000000000000000000000000000000000000000000000000000000000000200000000000000000";

// headers: 9516600_to_9516606
const VERIFIED_HEADERS_BYTES: &'static str = "0x1c017203a062da40a61596fff8df385e1803a37d912e9443c8ca274946edbe12f21dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d493471284214b9b9c85549ab3d2b972df0deef66ac2c9d6350b59463b0f85e66ce7baf8f2d11c4861377ecefe31b79db3613f4ef22a526035819fcd17bc49a5f3035bd056d54258bcaaedff556ce4915c49f506c8fea7a38d1c3c3deea5647a2a397f51aa52c70af96492dd945033b1ea190f4661e1ea00a04000000000000022100080001080000040002000420000800000000010008000410000001800010000400041400c0008000301150000400000000022600001400000801002220001000808000221601300000100000000000c0040000000000100200a1200008000400000000800000000000200100040100111000400408800050000410040400202004000000008000444000811080000204400000080020000040000000041000000020000000000000033000000400011102200000000000102000001000000000000108e0000002040020800100020040000002101011000020000082041000000400002000120000008080448016060080008000002000000000000000000000000000000000000000000000000000000000000003836910000000000bef9c7010000000000000000000000000000000000000000000000000000000096885a000000000000000000000000000000000000000000000000000000000095bbbd6000000000a504d883010100846765746888676f312e31352e35856c696e75780000001600553d1284214b9b9c85549ab3d2b972df0deef66ac2c935552c16704d214347f29fa77f77da6d75d7c7523679479c2402e921db00923e014cd439c606c5967a1a4ad9cc746a70ee58568466f7996dd0ace4e896c5d20b2a975c050e4220be276ace4892f4b41a980a75ecd1309ea12fa2ed87a8744fbfc9b863d5a2959d3f95eae5dc7d70144ce1b73b403b7eb6e0b71b214cb885500844365e95cd9942c7276e7fd8c89c669357d161d57b0b255c94ea96e179999919e625dd7ad2f7b88723857946a41af646c589c336e1e7e55c0f0a308c989ebccef3276256a33372647b4f9b61ab82666dd67af8e7404995bd96d87b056f46203d012ed3e4521788f19c4c6d434a23e3b8df112e1a01000000000000000000000000000000000000000000000000000000000000000020000000000000000034b15d2bdd589884741d5f2b0e4be29a5dcdc469c0cc27ac7e31f807efaeacb91dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934735552c16704d214347f29fa77f77da6d75d7c7522b78dda7c0b808ee9d5b8151bfd3a60b1a58269c8f8b463284f5a4690f43650b055d4a0f0fdf0ae45fed0e98df2bf76b3c6c52a86cde638e6387bff40fb656e576ba0a3fd5f4730528a08b7353b659d066c46bf602e0f6952a261c42027336610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000000000000000000000000000000002000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000008000000000000000000000000201000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000003936910000000000b6c1c9010000000000000000000000000000000000000000000000000000000079ef02000000000000000000000000000000000000000000000000000000000098bbbd60000000008501d883010a02846765746888676f312e31352e35856c696e75780000001600553d2e38fac35164660fa0ee02276627713ffd348ac3d84da664c5e1a84fc92c96a30109c7c0b56ff5f0d509f354424ad5beb58cdf2e107699bb5261b63ca8bb1b1c0100000000000000000000000000000000000000000000000000000000000000002000000000000000003474ad7643d2f7a5fcfcd4c4cf58ebf5bebd278fc6e54c58ed2b2ac3638271de1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d493473679479c2402e921db00923e014cd439c606c596ffa5ea329d920b70effd115b44a465a77d6efbb130bc08152e010afd6c823984e426d705ad680875a68e12f591ea16793cbde303f38676ef511601bf5a1114ba1493fee3f10464b3726beed5e508a14394ee0fa3bf4fce1e1f09361280e667780000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000000000000000000000000000000002000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000048000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000003a3691000000000080c3c9010000000000000000000000000000000000000000000000000000000091b90000000000000000000000000000000000000000000000000000000000009bbbbd60000000008501d883010006846765746888676f312e31352e35856c696e75780000001600553d6d3988c21ec42f01b7c92a55ba1388d19587eb3740fec47a7f70c69021049d3978b2e055212959e1694a1636fb95e6302a6c404c380928e88eaa12e2b7f005570000000000000000000000000000000000000000000000000000000000000000002000000000000000001cee01e6f8ce42c1b2539e3d31e4a4f4687b991e44efc792dd5178cbb7c13c541dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d493477a1a4ad9cc746a70ee58568466f7996dd0ace4e8352ede79848c26875970389970ea265feae15514472c4336e37647e8f3f0325834e5386aaed532c1b9a2be24b2e3a16ded8a6fed18eb7c0924d5ab2455b4ddd579f6fc41f28df8960cc1758f4cd6f7c30202b3411d58084248fceb2105f3cd030100000000100000000040000001000002000000040000000000001000000020100000000000000000080000000108000a00000020000000000000000024000000000000000000000010000800000000201800000104000000000000000200000020002002020000000000002040082000000800000010000000001000000000000000000001800040080000000000100000140001080000000000000080000002000000000000000000000000000000000000000000008000000000200010002000000200000080028000000004000000000000000800002200000000206000011000000000000001000000000000004000000040000000000001000000000002000000000000000000000000000000000000000000000000000000000000003b3691000000000080c3c9010000000000000000000000000000000000000000000000000000000027e30600000000000000000000000000000000000000000000000000000000009ebbbd60000000008501d883010007846765746888676f312e31352e38856c696e75780000001600553d51a38238db7900a9a570de3d58abf15e2b5fcf40ce3e60a45ed1707088148be61dc9053a83d6eae2f7a92779cc8554ce96af5e2eb532207c64fd6eb0eb037aba000000000000000000000000000000000000000000000000000000000000000000200000000000000000e03a7e316914333134299eb3b74f8853d7c0de416de839a0fa48347f868f644a1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934796c5d20b2a975c050e4220be276ace4892f4b41a3154975e092d9a613dc695cf97019bcf697455f839c5aa880189b1695e31987e2748038d0f7b4e8d8898c005c36dc1bf94f570c9f345587bbcc6d3ddf00d395b752e53876a0a9737065ff7ee62527f757ccbcefd9c9b866fa7edc6311844fd0a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000201000000000000000000000000000000000002000020000000000000002000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000003c3691000000000080c3c90100000000000000000000000000000000000000000000000000000000c347090000000000000000000000000000000000000000000000000000000000a1bbbd60000000008501d883010006846765746888676f312e31352e35856c696e75780000001600553df1e86c16a7f5c32d87b4717d1ca0a2df81da61f4f0316decb6f93afc0b50d5ad6471c8382332991f1877aedfda846758aa323d50dc8f7b7465a044bbd44e3fd5010000000000000000000000000000000000000000000000000000000000000000200000000000000000dec8d3e6f941abb1342cae0b31fcd29df3582e86518691995cb4fe6da094a26c1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347980a75ecd1309ea12fa2ed87a8744fbfc9b863d5bf3dd879dea5eb15f906f12e2b4f6146f1838f39cac6a9aa82476d98843a144c9b4b2eac1f62e7075f1dbe3ebf0008e882980beb1ff4bacf4d81d11454f41106cae8041526afbf5b3a48999d2b1899f88ccddadb282bc478b8f1bc0ee03912630000000000080400000000200000000000000000800040400000000000000800000140010000000000001000000010000000000000000000000000000000040000108000000000000000000800000000201000000000000000100000000000000000042002021000004000000000080000040000000000000010001010000000000000a000000000000000004001000810000c0000000000000000000000000000000000000800000000000040000200000000000000000040000000000004000000000200000000080000000000000004000000000000000000000000002000000000000000000001000000008060000000000000000020010000000000000002000000000000000000000000000000000000000000000000000000000000003d3691000000000080c3c90100000000000000000000000000000000000000000000000000000000a0e82e0000000000000000000000000000000000000000000000000000000000a4bbbd60000000008501d883010a02846765746888676f312e31352e35856c696e75780000001600553da8f7afce6ac0d9d4906b34ff2f6bb4c46f9b7d26917a87ff2581078fb030286149d59244743d1d7b2f94495853abf8e235085cf331eb92e1b4348c44f24bc8730100000000000000000000000000000000000000000000000000000000000000002000000000000000008145d94bf46170c92f1f8fafc303b4d6bde95b1b03f884b2ac289be52a2a0bad1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347a2959d3f95eae5dc7d70144ce1b73b403b7eb6e0d122b9e938c151f4c28ea6d1613e06aca234208bf27e22fc6ac737e7df089626d3200ece531adcd5fc7e5b8342647507e1fc123da5fb706dddc6b5f75ffa2c4d38017b9ace6c8ac5a8e91fe47a1b15431811cb850f289a350a3e629b47e0137d0000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020020000000000000080000000000000000000201000000000000000000000000000000000002000020000000000000000000000000010000000000000000000000000000000002000000040004000000000000000040000080000000000000000000002000000040000000000000000000000000000000000000000000000200000000000000800000000000000000000000000000000000000000000000000000000001000200000000001000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000003e3691000000000080c3c90100000000000000000000000000000000000000000000000000000000789a010000000000000000000000000000000000000000000000000000000000a7bbbd60000000008501d883010a02846765746888676f312e31352e35856c696e75780000001600553d56e3e9141dfa2815b0c00f6291d628ed6d0191d5b9eb1a39e2e8dc70aefb9ba657c5275de292123824766bde04b764b07ad247f2dc037eb83e51e99d604b9f30000000000000000000000000000000000000000000000000000000000000000000200000000000000000";

const SUBMIT_HEADER_BYTES: &'static str = "0x3d88dc9a505b0ed2d1d69601b33da491e8820dc2e278b3c25247e16784abea161dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347c89c669357d161d57b0b255c94ea96e17999991972e58f33063d686a2a9f858795b0cc7bdb43f83fb475f29712142409cfdb46dd23be7c3fcf9d400078755c02a163c26c0382d1b6aaa5ab3e05b003a2489059aa7c0cc1be44dfe4c94c680036d7cd041ede16dccadfaa24537f3ccef224fb0f5c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000020100000000000000000000000000000000000200002000000000000000000000000000000000000000000000000000000000000000000000000000010000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000001000000000000000000200000000000000000000000000000000000000000000000000000000000000403691000000000080c3c901000000000000000000000000000000000000000000000000000000000695000000000000000000000000000000000000000000000000000000000000adbbbd60000000008501d883010007846765746888676f312e31352e35856c696e75780000001600553df952160a93183da2e06577d3fe37b5bf756ed849473fdc858565ab68f31929960215f00cdfa8703a60e88a8c75b2334c5cb29156a0f24827504fe996b6840f2b000000000000000000000000000000000000000000000000000000000000000000200000000000000000";

benchmarks! {
	relay_finalized_epoch_header {
		let genesis_header = BSCHeader::decode(&mut hex2bytes_unchecked(GENSIS_HEADER_BYTES).as_slice()).unwrap();
		let header = Vec::<BSCHeader>::decode(&mut hex2bytes_unchecked(VERIFIED_HEADERS_BYTES).as_slice()).unwrap();
		let initial_authority_set =
				<BscBridge<T>>::extract_authorities(&genesis_header).unwrap();

		Authorities::<T>::put(&initial_authority_set);
		FinalizedAuthority::<T>::put(&initial_authority_set);
		FinalizedCheckpoint::<T>::put(&genesis_header);
		AuthoritiesOfRound::<T>::insert(
			&genesis_header.number / T::BSCConfiguration::get().epoch_length,
			(0u32..initial_authority_set.len() as u32).collect::<Vec<u32>>(),
			);
		let caller: T::AccountId = T::AccountId::decode(&mut &[0; 32][..]).unwrap_or_default();

	}:_(RawOrigin::Signed(caller), header)

	submit_header {
		let genesis_header = BSCHeader::decode(&mut hex2bytes_unchecked(GENSIS_HEADER_BYTES).as_slice()).unwrap();
		let update_headers = Vec::<BSCHeader>::decode(&mut hex2bytes_unchecked(VERIFIED_HEADERS_BYTES).as_slice()).unwrap();
		let submited_header = BSCHeader::decode(&mut hex2bytes_unchecked(SUBMIT_HEADER_BYTES).as_slice()).unwrap();
		let initial_authority_set =
				<BscBridge<T>>::extract_authorities(&genesis_header).unwrap();

		Authorities::<T>::put(&initial_authority_set);
		FinalizedAuthority::<T>::put(&initial_authority_set);
		FinalizedCheckpoint::<T>::put(&genesis_header);
		AuthoritiesOfRound::<T>::insert(
			&genesis_header.number / T::BSCConfiguration::get().epoch_length,
			(0u32..initial_authority_set.len() as u32).collect::<Vec<u32>>(),
			);
		let caller: T::AccountId = T::AccountId::decode(&mut &[0; 32][..]).unwrap_or_default();
		assert_ok!(<BscBridge<T>>::relay_finalized_epoch_header(
			RawOrigin::Signed(caller.clone()).into(),
			update_headers
		));
	}:_(RawOrigin::Signed(caller), submited_header)
}
